<!DOCTYPE html>

<html lang="en">
    <head>
        <title>PELARD-N Report</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="description" content="Monitoring Documentation Reporting" />
        <meta name="keywords" content="Human Rights,Violation,Northern Uganda" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <!-- Compiled and minified CSS -->
        <link href="https://fonts.googleapis.com/css2?family=Changa+One&display=swap" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" />
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" />
        <!-- Google Fonts -->
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet" />

        <!--Import Google Icon Font-->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

        <link rel="stylesheet" type="text/css" href="css/auth.css" />
        <link rel="stylesheet" type="text/css" href="css/styles.css" />
        <style>
         .card-two, .card-three,.card-four{
          display: none;
      }
            header,
            main,
            footer {
                padding-left: 300px;
            }

            @media only screen and (max-width: 992px) {
                header,
                main,
                footer {
                    padding-left: 0;
                }
            }

            h1 {
                font-family: "Changa One", cursive;
            }
            .btn {
                background-color: var(--Blue);
            }
            .logos {
                width: 55px;
                height: 50px;
            }
            .partners {
                display: inline;
            }
        </style>
    </head>

    <body>
        <nav><!-- navbar content here  --></nav>

        <ul id="slide-out" class="sidenav sidenav-fixed">
            <li>
                <div class="user-view">
                    <div class="background">
                        <img src="images/EU.png" />
                    </div>
                    <a href="#user"><img class="circle" src="images/avatar-9.png" /></a>
                    <a href="#name"><span class="white-text name">Adrian Ssali</span></a>
                    <a href="#email"><span class="white-text email">jdandturk@gmail.com</span></a>
                </div>
            </li>

            <li>
                <a href="https://pelard-n.netlify.app/"><i class="material-icons">home</i>Home</a>
            </li>
            <li>
                <a href="https://pelard-n.netlify.app/"><i class="material-icons">dashboard</i>Dashboard</a>
            </li>
            <li>
                <a href="settings.html"><i class="material-icons">settings</i>Settings</a>
            </li>

            <li><div class="divider"></div></li>
            <li><a class="waves-effect" href="index.html">Logout</a></li>
        </ul>
        <a href="#" data-target="slide-out" class="black-text sidenav-trigger show-on-large"><i class="material-icons">menu</i></a>

        <!--Side nav End-->
        <main>
            <div id="create" class="home-width">
                <div class="form-section__header">
                    <h3 class="header center">
                        <span class="white-text">Reporting New Case</span>
                    </h3>
                </div>
                <div class="card-one" id="home-started-card-container">
                    <div id="home-started-card" class="">
                        <div class="row">
                            <h5 class="header center #01579b light-blue-text text-darken-4">1.Reporter's Information</h5>
                            <div class="col s12 relative">
                                <label class="input-box input-field">
                                    <input id="reporterName" class="input input__first-name" type="text" placeholder="Name" name="first-name" />
                                    <div class="input-invalid-message">Reporter's Name cannot be empty</div>
                                </label>

                                <label class="input-box" for="phone">
                                    <small>Format: 7-000-0000</small>
                                    <input id="reporterContact" class="input" type="tel" id="phone" placeholder="Contact Phone" name="phone" required />
                                </label>

                                <label class="input-box">
                                    Date And Time
                                    <input id="dateTime" type="datetime-local" class="datepicker" placeholder="Date And Time" />
                                </label>
                                 <button class="btn btn-small" onclick="moveToCard2()">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-two" id="home-started-card-container">
                    <div id="home-started-card" class="">
                        <div class="row">
                            <h5 class="header center #01579b light-blue-text text-darken-4">2.Violation Details</h5>
                            <br />
                            <br />
                            <div class="col s12 relative">

                                <label class="input-box input-field">
                                    <select id="districtOfViolation">
                                        <option value="" disabled selected>District Of Violation</option>
                                        <option value="1">Agogo</option>
                                        <option value="2">Amuru</option>
                                        <option value="3">Gulu</option>
                                        <option value="4">Kitgum</option>
                                        <option value="5">Lamwo</option>
                                        <option value="6">Nwoya</option>
                                        <option value="7">Pader</option>
                                    </select>
                                </label>

                                <label>
                                    <select id="violationType">
                                        <option value="" disabled selected>Type Of Violation</option>
                                        <option value="1">Assault</option>
                                        <option value="2">Domestic Violance</option>
                                        <option value="3">Attempted Murder</option>
                                        <option value="4">Destruction Of Property</option>
                                        <option value="5">Harrassment</option>
                                        <option value="6">Intimidation</option>
                                    </select>
                                </label>

                                <label class="input-box input-field">
                                    <span>Description Of Violation</span>
                                    <textarea id="violationDescription" placeholder="Discription Of Violation" id="textarea1" class="materialize-textarea"></textarea>
                                </label>

                                <label class="input-box input-field">
                                    <span>Damages/Injuries</span>
                                    <textarea id="injuries" placeholder="Damages/Injuries" id="textarea1" class="materialize-textarea"></textarea>
                                </label>

                                  <label class="input-box input-field">
                                    <span>Contacted Authorities</span>
                                    <textarea id="contactAuthority" placeholder="Contacted Authorities" id="textarea1" class="materialize-textarea"></textarea>
                                </label>

                                <label class="input-box input-field">
                                    <span>Response By Authorities</span>
                                    <textarea id="authorityResponse" placeholder="Response By Authorities" id="textarea1" class="materialize-textarea"></textarea>
                                </label>

                                <label class="input-box input-field">
                                    <span>Any Other Violations/Details</span>
                                    <textarea id="otherViolation" placeholder="Any Other Violations/Details" id="textarea1" class="materialize-textarea"></textarea>
                                </label>
                                <button class="btn btn-small" onclick="moveBackToCard1()">Back</button>
                                <button class="btn btn-small" onclick="moveToCard3()">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-three" id="home-started-card-container">
                    <div id="home-started-card" class="">
                        <div class="row">
                            <h5 class="header center #01579b light-blue-text text-darken-4">3.People Involved</h5>
                            <div class="col s12 relative">
                                <label class="input-box">
                                    <input id="victimName" class="input input__last-name" type="text" placeholder="Victim's Name" name="last-name" />
                                    <div class="input-invalid-message">Victim cannot be empty</div>
                                </label>
                                <label class="input-box input-field">
                                    <span>Any Other Victims</span>
                                    <textarea id="otherVictim" placeholder="Any Other Victims" id="textarea1" class="materialize-textarea"></textarea>
                                </label>
                                <label class="input-box">
                                    <input id="suspectName" class="input input__first-name" type="text" placeholder="Suspect's Name" name="first-name" />
                                    <div class="input-invalid-message">Suspect cannot be empty</div>
                                </label>
                                <label class="input-box input-field">
                                    <span>Any Other Suspects</span>
                                    <textarea id="otherSuspect" placeholder="Any Other Suspets" id="textarea1" class="materialize-textarea"></textarea>
                                </label>
                                <label class="input-box">
                                    <input id="witnessName" class="input input__last-name" type="text" placeholder="Witness'Name" name="last-name" />
                                    <div class="input-invalid-message">Witness cannot be empty</div>
                                </label>
                                <label class="input-box input-field">
                                    <span>Any Other Witnesses</span>
                                    <textarea id="otherWitness" placeholder="Any Other Witnesses" id="textarea1" class="materialize-textarea"></textarea>
                                </label>
                                <button class="btn btn-small" onclick="moveBackToCard2()">Back</button>
                                <button class="btn btn-small" onclick="moveToCard4()">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-four" id="home-started-card-container">
                    <div id="home-started-card" class="">
                        <div class="row">
                            <h5 class="header center #01579b light-blue-text text-darken-4">4.Visual/Audio Evidence</h5>
                            <div class="col s12 relative">
                                <div class="field-status-icons">
                                    <i style="display: none;" id="create-group-email-is-valid" class="green-text mdi-navigation-check"></i>
                                    <i style="display: none;" id="create-group-email-is-not-valid" class="red-text mdi-navigation-close"></i>
                                </div>

                                <div class="file-field input-field">
                                    <div class="btn">
                                        <span>Upload File</span>
                                        <input type="file" id="img" name="img" accept="audio/*,video/*,image/*" />
                                    </div>
                                    <div class="file-path-wrapper">
                                        <input class="file-path validate" type="text" />
                                    </div>
                                </div>
                                 <label class="input-box input-field">
                                    <span>Uploaded File Description</span>
                                    <textarea id="fileDescription" placeholder="Fule Description" id="textarea1" class="materialize-textarea"></textarea>
                                </label>
                                <button class="btn btn-small" onclick="moveBackToCard3()">Back</button>
                            </div>
                        </div>
                        <div id="home-started-card-no-user-panel">
                            <div class="col s12" id="create-group-message-container">
                                <div class="materialize-red-text lighten-2"></div>
                            </div>
                            <div class="col s12 center relative">
                                <div style="display: none;" id="create-group-spinner" class="">
                                    <div class="preloader-wrapper small active">
                                        <div class="spinner-layer spinner-blue">
                                            <div class="circle-clipper right">
                                                <div class="circle"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <button id="create-group-button" class="btn btn-large strong-text">
                                    Report This Case
                                    <svg style="width: 24px; height: 24px; top: 6px; position: relative; right: 2px;" viewBox="0 0 24 24">
                                        <path fill="#ffffff" d="M5.59,7.41L7,6L13,12L7,18L5.59,16.59L10.17,12L5.59,7.41M11.59,7.41L13,6L19,12L13,18L11.59,16.59L16.17,12L11.59,7.41Z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="page-footer">
            <div class="right footer-copyright">
                <h6><span class="#01579b light-blue-text text-darken-4">PELARD</span></h6>
                <div class="col l6 s12">
                    <ul>
                        <li class="partners">
                            <a class="white-text" href="#!"><img class="logos" src="images/EU.png" /></a>
                        </li>
                        <li class="partners">
                            <a class="white-text" href="#!"><img class="logos" src="images/EU.png" /></a>
                        </li>
                        <li class="partners">
                            <a class="white-text" href="#!"><img class="logos" src="images/EU.png" /></a>
                        </li>
                        <li class="partners">
                            <a class="white-text" href="#!"><img class="logos" src="images/EU.png" /></a>
                        </li>
                    </ul>
                </div>
            </div>
        </footer>
        <!-- Footer -->

        <!-- Compiled and minified JavaScript -->
        <script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha256-MlusDLJIP1GRgLrOflUQtshyP0TwT/RHXsI1wWGnQhs=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

        <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
        <script>
            $(document).ready(function () {
                $(".sidenav").sidenav();
                $("select").formSelect();
            });
        </script>

        <script>
  var card1 = document.querySelector(".card-one");
  var card2 = document.querySelector(".card-two");
  var card3 = document.querySelector(".card-three");
  var card4 = document.querySelector(".card-four");
  function moveToCard2() {
   card1.style.display = "none"
   card2.style.display = "block"
   card3.style.display = "none"
   card4.style.display = "none"
  }

  function moveToCard3() {
    card1.style.display = "none"
    card2.style.display = "none"
    card3.style.display = "block"
    card4.style.display = "none"
  }
  function moveToCard4() {
    card1.style.display = "none"
    card2.style.display = "none"
    card3.style.display = "none"
    card4.style.display = "block"
   }
 

   function moveBackToCard3() {
    card1.style.display = "none"
    card2.style.display = "none"
    card3.style.display = "block"
    card4.style.display = "none"
   }
 
   function moveBackToCard2() {
     card1.style.display = "none"
     card2.style.display = "block"
     card3.style.display = "none"
     card4.style.display = "none"
   }
   function moveBackToCard1() {
     card1.style.display = "block"
     card2.style.display = "none"
     card3.style.display = "none"
     card4.style.display = "none"
    }
   

</script>
        <script>
            const baseUrl = "https://pelard-n.herokuapp.com";
            const secret = "2cfb9e9a-34a9-4843-961f-6e2639c41856-b10445eb-a0e8-4fa2-b636-015b2f1e3660";

            const handleSubmit = async ({ files }) => {
                try {
                    const SERVER_URI = "https://api.cloudinary.com/v1_1/dwa3soopc/upload";

                    const formData = new FormData();

                    formData.append("file", files[0]);
                    formData.append("upload_preset", "dh1h4tq3");
                    formData.append("folder", "pelard-n");

                    const options = {
                        method: "POST",
                        body: formData,
                    };

                    const response = await fetch(SERVER_URI, options);
                    const json = await response.json();
                    const { secure_url } = json;
                    return secure_url
                    //console.log(`secure_url ${secure_url}`); // You send me this secure url
                } catch (errors) {
                    console.log(errors);
                }
            };

            const getToken = async ({ secret, _id }) => {
                const response = await fetch(`${baseUrl}/token/generate`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ secret, _id }),
                });

                const json = await response.json();
                console.log(json);
                return json.data.token;
            };

            const caseRegistration = async (e) => {
                e.preventDefault();
          //Reporters Information
                const reporterName = document.getElementById("reporterName").value;
                const reporterContact = document.getElementById("reporterContact").value;
                const dateTime =document.getElementById('dateTime').value;
          //Violation Details
                const districtOfViolation = document.getElementById("districtOfViolation").options[
                                      document.getElementById("districtOfViolation").selectedIndex].value;
                 const violationType = document.getElementById("violationType").options[
                                      document.getElementById("violationType").selectedIndex].value;
                const violationDescription = document.getElementById("violationDescription").value;
                const injuries = document.getElementById("injuries").value;
                 const contactAuthority = document.getElementById("contactAuthority").value;
                const authorityResponse = document.getElementById("authorityResponse").value;
                const otherViolation = document.getElementById("otherViolation").value;
          //People Involved 
                const victimName = document.getElementById("victimName").value;
                const otherVictim = document.getElementById("otherVictim").value;
                const suspectName = document.getElementById("suspectName").value;
                const otherSuspect  = document.getElementById("otherSuspect").value;
                const witnessName = document.getElementById("witnessName").value;
                const otherWitness = document.getElementById("otherWitness").value;
          //Evidence     
                const files = document.getElementById("img").files;
                const fileDescription = document.getElementById("fileDescription").value;

                handleSubmit({ files });
                try {
                    const token = await getToken({ secret });
                    const secure_url = await  handleSubmit({ files });
                    const response = await fetch(`${baseUrl}/violations/create`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: token,
                        },
                        body: JSON.stringify(
                          {
                            reporter: {
                                name: reporterName,
                                contact: reporterContact,
                            },
                            dateTime: dateTime,
                            type: violationType,
                            description: violationDescription,
                            location: {
                                name: districtOfViolation,
                            },
                            
                            involved: [
                                { type: "victim", name: victimName,
                                relevantLinks:[
                                { 
                                  description:otherVictim
                                  }
                                ] 
                                },

                                { type: "suspect", name: suspectName,
                                relevantLinks:[
                                { 
                                  description:otherSuspect
                                  }
                                ] 
                                 },
                                { type: "witness", name: witnessName,
                                relevantLinks:[
                                { 
                                  description:otherWitness
                                  }
                                ] 
                                 },
                            ],
                             injuries: [
                                {description:injuries,link:secure_url}
                            ],
                            authorityResponse:[
                                { name: contactAuthority, response: authorityResponse,
                                 relevantLinks:[
                                { 
                                  description:otherViolation,
                                  link:fileDescription
                                  }
                                ] 
                                 },
                               
                            ]
                        }),
                    });

                    const json = await response.json();
                    console.log("Registration");
                } catch (errors) {
                    console.log(errors);
                }
            };

            document.getElementById("create-group-button").addEventListener("click", caseRegistration);
        </script>
    </body>
</html>
